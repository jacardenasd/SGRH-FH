<!DOCTYPE html>
<html>
<head>
    <title>Test CURP Extraction</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
    <h2>Test CURP Data Extraction</h2>
    
    <div style="margin-bottom: 20px;">
        <label>CURP:</label>
        <input type="text" id="curp" maxlength="18" value="HEMC920315HDFRNM09" style="padding: 5px; font-size: 16px;">
        <small>(Press TAB or blur to extract)</small>
    </div>
    
    <div style="margin-bottom: 10px;">
        <label>Fecha Nacimiento:</label>
        <input type="date" id="fecha_nacimiento" style="padding: 5px;">
    </div>
    
    <div style="margin-bottom: 10px;">
        <label>Sexo:</label>
        <select id="sexo" style="padding: 5px;">
            <option value="">-</option>
            <option value="M">M</option>
            <option value="F">F</option>
        </select>
    </div>
    
    <div style="margin-bottom: 10px;">
        <label>Lugar de Nacimiento:</label>
        <input type="text" id="lugar_nacimiento" style="padding: 5px; width: 300px;">
    </div>
    
    <div style="margin-bottom: 10px;">
        <label>Nacionalidad:</label>
        <input type="text" id="nacionalidad" style="padding: 5px;">
    </div>
    
    <hr>
    
    <div style="margin-bottom: 20px;">
        <label>Sueldo Diario:</label>
        <input type="number" id="sueldo_diario" step="0.01" value="500" style="padding: 5px; width: 150px;">
        <small>(Change value to calculate monthly)</small>
    </div>
    
    <div style="margin-bottom: 10px;">
        <label>Sueldo Mensual (Calculated):</label>
        <input type="number" id="sueldo_mensual" step="0.01" style="padding: 5px; width: 150px;" readonly>
    </div>
    
    <script>
    // Mapeo de códigos de entidad CURP a estados de nacimiento
    var entidadMap = {
      'AS': 'Aguascalientes', 'BC': 'Baja California', 'BS': 'Baja California Sur',
      'CC': 'Campeche', 'CS': 'Chiapas', 'CH': 'Chihuahua', 'CD': 'Ciudad de México',
      'CL': 'Coahuila', 'CM': 'Colima', 'DG': 'Durango', 'GT': 'Guanajuato',
      'GR': 'Guerrero', 'HG': 'Hidalgo', 'JC': 'Jalisco', 'MC': 'Estado de México',
      'MN': 'Michoacán', 'MS': 'Morelos', 'NT': 'Nayarit', 'NL': 'Nuevo León',
      'OC': 'Oaxaca', 'PL': 'Puebla', 'QT': 'Querétaro', 'QR': 'Quintana Roo',
      'SL': 'San Luis Potosí', 'SN': 'Sonora', 'SP': 'Sinaloa', 'SR': 'Sinaloa',
      'TC': 'Tabasco', 'TL': 'Tlaxcala', 'VZ': 'Veracruz', 'YN': 'Yucatán',
      'ZS': 'Zacatecas', 'NE': 'Extranjero'
    };

    function extractCURPData() {
      var curp = $('#curp').val().trim().toUpperCase();
      
      if (curp.length !== 18) {
        console.log('CURP debe tener 18 caracteres, tiene: ' + curp.length);
        return;
      }
      
      try {
        var yy = curp.substring(4, 6);
        var mm = curp.substring(6, 8);
        var dd = curp.substring(8, 10);
        
        console.log('YY: ' + yy + ', MM: ' + mm + ', DD: ' + dd);
        
        var centuryChar = curp.charAt(16);
        var century = /^[0-9]$/.test(centuryChar) ? '19' : '20';
        var yyyy = century + yy;
        
        console.log('Century char: ' + centuryChar + ', Century: ' + century + ', YYYY: ' + yyyy);
        
        var fechaNac = new Date(yyyy + '-' + mm + '-' + dd);
        if (isNaN(fechaNac.getTime())) {
          console.log('Fecha inválida');
          return;
        }
        
        var fechaFormato = yyyy + '-' + mm + '-' + dd;
        $('#fecha_nacimiento').val(fechaFormato);
        console.log('Fecha establecida: ' + fechaFormato);
        
        var sexoChar = curp.charAt(10);
        var sexo = sexoChar === 'H' ? 'M' : 'F';
        $('#sexo').val(sexo);
        console.log('Sexo char: ' + sexoChar + ', Sexo: ' + sexo);
        
        var entidadCod = curp.substring(11, 13);
        var lugarNacimiento = entidadMap[entidadCod] || entidadCod;
        $('#lugar_nacimiento').val(lugarNacimiento);
        console.log('Entidad código: ' + entidadCod + ', Lugar: ' + lugarNacimiento);
        
        var nacionalidad = entidadCod === 'NE' ? 'Extranjero' : 'Mexicano';
        $('#nacionalidad').val(nacionalidad);
        console.log('Nacionalidad: ' + nacionalidad);
        
      } catch (e) {
        console.error('Error al extraer datos del CURP:', e);
      }
    }

    function calcularSueldoMensual() {
      var sueldoDiario = parseFloat($('#sueldo_diario').val()) || 0;
      if (sueldoDiario > 0) {
        var sueldoMensual = (sueldoDiario * 30).toFixed(2);
        $('#sueldo_mensual').val(sueldoMensual);
        console.log('Sueldo diario: ' + sueldoDiario + ', Sueldo mensual: ' + sueldoMensual);
      }
    }

    $(document).ready(function() {
      $('#curp').on('blur', function() {
        console.log('CURP blur event');
        extractCURPData();
      });

      $('#sueldo_diario').on('change', function() {
        console.log('Sueldo diario change event');
        calcularSueldoMensual();
      });
      
      calcularSueldoMensual();
    });
    </script>
</body>
</html>
